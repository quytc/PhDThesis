\begin{tikzpicture}[scale=0.8]

  \begin{scope}
    \matrix (m) [na-matrix] {
      |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]|3 & |[na-context]| \\
    };

    \makehighgroup{m-1-1}{m-1-2}{2}
    \makehighgroup{m-1-3}{m-1-4}{4}
    \makehighgroup[densely dotted]{m-1-5}{m-1-6}{6}
    \draw[na-edge,->] (m-1-8) .. controls +(115:10mm) and +(30:7mm) .. (n2);
    \draw[na-edge,->] (m-1-8) .. controls +(115:8mm) and +(30:5mm) .. (n4);
    \draw[na-edge,->,densely dotted] (m-1-8) .. controls +(115:6mm) and +(30:3mm) .. (n6);

    \matrix[na-matrix] (m2) at (0,-1.5) {
      |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]|3 & |[na-context]| \\
    };

    \makehighgroup{m2-1-1}{m2-1-2}{2}
    \makehighgroup{m2-1-3}{m2-1-4}{4}
    \makehighgroup{m2-1-5}{m2-1-6}{6}
    \draw[na-edge,->] (m2-1-8) .. controls +(115:10mm) and +(30:7mm) .. (n2);
    \draw[na-edge,->] (m2-1-8) .. controls +(115:8mm) and +(30:5mm) .. (n4);
    \draw[na-edge,->] (m2-1-8) .. controls +(115:6mm) and +(30:3mm) .. (n6);

    \begin{pgfonlayer}{my background}
      \draw[background rectangle,double=white] ([shift={(-0.3,0.5)}]m.north west) rectangle ([shift={(0.3,-0.5)}]m2.south east);
    \end{pgfonlayer}

    \node[rotate=-90] at (barycentric cs:m-1-8=0.5,m2-1-8=0.5){$\trans$};
    \node[na-looplabel] at ([shift={(0,-0.5)}]m2.south) {Iteration};
  \end{scope}

  %% ================================================

  \begin{scope}[xshift=5cm]
    \matrix (m) [na-matrix] {
      |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]| & |[na-context,draw=red!50]|5
      & |[na-state]| & |[na-context]|
      & |[na-state]|3 & |[na-context]| \\
    };

    \makehighgroup{m-1-1}{m-1-2}{2}
    \makehighgroup{m-1-3}{m-1-4}{4}
    \makehighgroup[draw=red,densely dotted]{m-1-5}{m-1-6}{6}
    \draw[na-edge,->] (m-1-8) .. controls +(115:10mm) and +(30:7mm) .. (n2);
    \draw[na-edge,->] (m-1-8) .. controls +(115:8mm) and +(30:5mm) .. (n4);
    \draw[na-edge,->,draw=red,densely dotted] (m-1-8) .. controls +(115:6mm) and +(30:3mm) .. (n6);

    \matrix[na-matrix] (m2) at (0,-1.5) {
      |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]| & |[na-context,draw=red!50]|5
      & |[na-state]| & |[na-context]|
      & |[na-state,draw=red!50,fill=red!20]|4 & |[na-context]| \\
    };

    \begin{pgfonlayer}{my background}
      \draw[background rectangle,double=white] ([shift={(-0.3,0.5)}]m.north west) rectangle ([shift={(0.3,-0.5)}]m2.south east);
    \end{pgfonlayer}

    \node[rotate=-90] at (barycentric cs:m-1-8=0.5,m2-1-8=0.5){$\trans$};
    \node[na-looplabel] at ([shift={(0,-0.5)}]m2.south) {Escape};
  \end{scope}

  %% ================================================
  \begin{scope}[xshift=10cm]
    \matrix (m) [na-matrix] {
      |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]|3 & |[na-context]| \\
    };

    \makehighgroup{m-1-1}{m-1-2}{2}
    \makehighgroup{m-1-3}{m-1-4}{4}
    \makehighgroup{m-1-5}{m-1-6}{6}

    \draw[blue!70!red] (m-1-7.north west) ++(0,0.5mm) -- +(0,1mm) -- ([yshift=1mm]m-1-7.north east) coordinate[pos=0.4](n7) -- +(0,-0.5mm);
    \draw[blue!70!red] (m-1-9.north east) ++(0,0.5mm) -- +(0,1mm) -- ([yshift=1mm]m-1-9.north west) coordinate[pos=0.4](n9) -- +(0,-0.5mm);

    \draw[na-edge,->] (m-1-8) .. controls +(115:10mm) and +(30:7mm) .. (n2);
    \draw[na-edge,->] (m-1-8) .. controls +(115:8mm) and +(30:5mm) .. (n4);
    \draw[na-edge,->] (m-1-8) .. controls +(115:6mm) and +(30:3mm) .. (n6);
    \draw[na-edge,->] (m-1-8) .. controls +(115:5mm) and +(30:2mm) .. (n7);
    \draw[na-edge,->] (m-1-8) .. controls +(65:5mm) and +(150:2mm) .. (n9);

    \matrix[na-matrix] (m2) at (0,-1.5) {
      |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state]| & |[na-context]|
      & |[na-state,draw=green!50!blue,fill=green!20]|7 & |[na-context]| \\
    };

    \begin{pgfonlayer}{my background}
      \draw[background rectangle,double=white] ([shift={(-0.3,0.5)}]m.north west) rectangle ([shift={(0.3,-0.5)}]m2.south east);
    \end{pgfonlayer}

    \node[rotate=-90] at (barycentric cs:m-1-8=0.5,m2-1-8=0.5){$\trans$};
    \node[na-looplabel] at ([shift={(0,-0.5)}]m2.south) {Terminal};
  \end{scope}

\end{tikzpicture}
