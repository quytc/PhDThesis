\begin{tikzpicture}[%
  scale=0.5%
  ,state/.append style={scale=0.9,semithick}%
  ,myedge/.append style={very thin,green!20!orange}%
  ]

  \begin{scope}
    \foreach \n in {1,2,3,4,6}{\node[state,state-n](n\n) at (\n,0){ {\hspace{2ex}} };}
    \node[state,state-n](n5) at (5,0){$3$};

    %\draw[myedge,->,blue!70!red] (n5) .. controls +(135:6mm) and +(30:6mm) .. (n4);
    %\draw[myedge,->,blue!70!red] (n5) .. controls +(135:8mm) and +(30:10mm) .. (n3);
    \draw[myedge,->,blue!70!red] (n5) .. controls +(135:10mm) and +(30:14mm) .. (n2);
    \draw[myedge,->,blue!70!red] (n5) .. controls +(135:12mm) and +(30:18mm) .. (n1);

    \draw[myedge,->] (n1) .. controls +(-45:6mm) and +(-150:6mm) .. (n2);
    \draw[myedge,->] (n1) .. controls +(-45:8mm) and +(-150:10mm) .. (n3);
    \draw[myedge,->] (n1) .. controls +(-45:10mm) and +(-150:14mm) .. (n4);

    \begin{pgfonlayer}{my background}
      \node[scale=0.5,fit=(n1)(n6),background rectangle,double=white,fill=black!10!white](bgFrom){};
    \end{pgfonlayer}
  \end{scope}

  \node[rotate=-90] at (5,-1){$\trans$};

  \begin{scope}[shift={(0,-2)}]
    \foreach \n in {1,2,3,4,6}{\node[state,state-n](n\n) at (\n,0){ {\hspace{2ex}} };}
    \node[state,state-n](n5) at (5,0){$3$};

    %\draw[myedge,->,blue!70!red] (n5) .. controls +(135:6mm) and +(30:6mm) .. (n4);
    \draw[myedge,->,blue!70!red] (n5) .. controls +(135:8mm) and +(30:10mm) .. (n3);
    \draw[myedge,->,blue!70!red] (n5) .. controls +(135:10mm) and +(30:14mm) .. (n2);
    \draw[myedge,->,blue!70!red] (n5) .. controls +(135:12mm) and +(30:18mm) .. (n1);

    \draw[myedge,->] (n1) .. controls +(-45:6mm) and +(-150:6mm) .. (n2);
    \draw[myedge,->] (n1) .. controls +(-45:8mm) and +(-150:10mm) .. (n3);
    \draw[myedge,->] (n1) .. controls +(-45:10mm) and +(-150:14mm) .. (n4);

    \begin{pgfonlayer}{my background}
      \node[scale=0.5,fit=(n1)(n6),background rectangle,double=white,fill=black!10!white](bgTo){};
    \end{pgfonlayer}
  \end{scope}

  \begin{pgfonlayer}{my background}
    \draw[background rectangle,double=white] ([shift={(-0.5,0.5)}]bgFrom.north west) rectangle ([shift={(0.5,-0.6)}]bgTo.south east);
  \end{pgfonlayer}

  \node[looplabel] at ([shift={(0,-0.6)}]bgTo.south){Iteration};
\end{tikzpicture}
