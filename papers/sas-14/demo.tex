\begin{tikzpicture}[%scale=0.8,
  % mystate/.style={circle,draw=none,fill=white,thick,inner sep=1pt,scale=0.8},
  guard/.style={scale=0.6,thin},
  barrier/.style={rounded corners,draw,double,inner ysep=3pt, inner xsep=10pt,fill=black!10},
  ]

  \node[state,state-i](before) at (0,0) {B};
  \node[state,state-n](wait) at (-1,-1) {W};
  \node[state,state-n](pivot) at (1,-1) {P};
  \node[state,state-n](after) at (0,-2) {A};

  \draw[->,myedge] (before) ..controls +(-100:12mm) and +(15:8mm).. node[guard,pos=0.7,below]{$\exists~P$} (wait);
  \draw[->,myedge] (before) ..controls +(-80:12mm) and +(165:8mm).. node[guard,pos=0.7,below]{$\forall~B$} (pivot);
  
%   \draw[->,myedge] (wait) ..controls +(-15:10mm) and +(100:10mm).. node[guard,below]{$\not\exists~P$} (after);
%   \draw[->,myedge] (pivot) ..controls +(-165:10mm) and +(80:10mm).. node[guard,below]{$\forall~W$} (after);
  \draw[->,myedge] (wait) to[out=-90,in=180] node[guard,midway,below left]{$\not\exists~P$} (after);
  \draw[->,myedge] (pivot) to[out=-90,in=0] node[guard,midway,below right]{$\forall~W$} (after);

  \begin{pgfonlayer}{my background}
    \node[barrier,fit=(wait) (pivot)] (r){};
  \end{pgfonlayer}
  
\end{tikzpicture}
